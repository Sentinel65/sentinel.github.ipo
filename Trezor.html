<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hra Trezor</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
    }
    #gameContainer {
      display: grid;
      grid-template-areas: 
        "letters letters letters"
        "left board right"
        "bottom bottom bottom"
        "skimmers skimmers skimmers";
      gap: 10px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-gap: 5px;
      justify-content: center;
      margin: 10px;
      grid-area: board;
    }
    .cell {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #000;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
    }
    .cell.clicked { background-color: #4B4C4B; color: #fff;cursor: not-allowed;pointer-events: none;} /* Styl označených políček */
    .disabled { background-color: #000; cursor: default; } /* Nehratelná políčka */
    .used { background-color: #d3d3d3; cursor: default; color: #333; } /* Styl použitých kostek */
    .odd { background-color: #e0ffe0; } /* Lichá čísla */
    .even { background-color: #e0e0ff; } /* Sudá čísla */
    .double { background-color: #ffe0e0; } /* Double */
    #letters, #left, #right, #bottom {
      display: grid;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
    }
    #letters {
      grid-template-columns: repeat(7, 1fr);
      grid-area: letters;
	  margin-right: 30px;
    }
    #left {
      grid-template-rows: repeat(6, 1fr);
      grid-area: left;
      justify-content: end;
      margin-top: 28px;
    }
    #right {
      grid-template-rows: repeat(6, 1fr);
      grid-area: right;
      margin-top: 28px;
    }
    #bottom {
      grid-template-columns: repeat(7, 1fr);
      grid-area: bottom;
	  margin-right: 18px;
    }
    #skimmers {
      grid-area: skimmers;
      display: flex;
      justify-content: center;
      gap: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }
    .score {
    font-size: 14px;
    font-weight: bold;
    }
    .highscore {
    font-size: 14px;
    font-weight: bold;
    }
    .skimmer {
      padding: 5px 10px;
      border: 2px solid #333;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
    }
    .skimmer.clicked { background-color: #ffcccb; } /* Styl označených skimmerů */
    #diceContainer {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .skimmer.disabled {
	  background-color: #d3d3d3;
	  color: #888;
	  cursor: not-allowed;
	  border-color: #888;
	}
    
      /* Stylování pro tlačítka nápovědy  */
	  .help-button {
		padding: 5px 10px;
		border: 2px solid #333;
		border-radius: 5px;
		cursor: pointer;
		background-color: #add8e6;
		font-size: 20px;
		font-weight: bold;
		user-select: none;
	 }
    
      /* Stylování pro tlačítka ReRoll */
	  .reroll-button {
		padding: 5px 10px;
		border: 2px solid #333;
		border-radius: 5px;
		cursor: pointer;
		background-color: #add8e6;
		font-size: 14px;
		font-weight: bold;
		user-select: none;
	 }

	  /* Styl pro deaktivovaná tlačítka */
	  .reroll-button.disabled {
		background-color: #d3d3d3;
		color: #888;
		cursor: not-allowed;
		border-color: #888;
	 }
	   .highlight {
	  background-color: lightgreen;
	  color: black;
	  font-weight: bold;
	} 
	  .highlight-empty {
	  background-color: yellow;
	  color: black;
	  font-weight: bold;
	}

	  .highlight-filled {
	  background-color: #4B4C4B;
	  color: yellow;
	  font-weight: bold;
	}
		.die {
		  width: 40px;
		  height: 40px;
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  border: 2px solid #333;
		  border-radius: 5px;
		  font-size: 18px;
		  font-weight: bold;
		  cursor: pointer;
		  user-select: none;
		}
    .die.clicked { background-color: #90cfff; } /* Styl označených kostek */
    #rollButton {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      .cell, .die {
        width: 30px;
        height: 30px;
        font-size: 12px;
      }
      #letters, #left, #right, #bottom, #skimmers {
        font-size: 14px;
      }
      .skimmer { padding: 5px; }
    }
		/* Modální okno */
	.modal {
	  display: none;
	  position: fixed;
	  z-index: 1;
	  padding-top: 60px;
	  left: 0;
	  top: 0;
	  width: 100%;
	  height: 100%;
	  overflow: auto;
	  background-color: rgb(0,0,0);
	  background-color: rgba(0,0,0,0.4);
	}

	/* Obsah modálního okna */
	.modal-content {
	  background-color: #fefefe;
	  margin: 5% auto;
	  padding: 20px;
	  border: 1px solid #888;
	  width: 80%;
	}

	/* Tlačítko pro zavření modálního okna */
	.close {
	  color: #aaa;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.close:hover,
	.close:focus {
	  color: black;
	  text-decoration: none;
	  cursor: pointer;
	}
  </style>
</head>
<body>


<button id="helpButton" class="help-button" onclick="handleButtonClick()">Hra Trezor</button>
</br>
<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeHelp()">&times;</span>
  <h2>TREZOR</h2>
    <p>Kostková solitaire hra. Zdigitalizovaná verze (JavaScript) PnP hry <b>"Vault: A Solitaire Dice Game (2021)"</b>, autorem je <b>Wayne Koenig</b></p>
    <p>Ve hře představujete bankovního lupiče, který se snaží prolomit specializovaný trezor. Pomocí hodu kostkami a pečlivého plánování doufáte, že se vám podaří dostat ven s co největším počtem diamantů dříve, než se všechny zámky na trezoru zavřou. Některé zámky obsahují více diamantů než jiné, takže je na vás, abyste se rozhodli, na kterém zámku strávíte svůj čas s ohledem na hozené hodnoty na kostkách.</p>
  <h3>Průběh hry</h3>
    <p>Trezor, který se snažíte rozlousknout, má 12 zámků, na každém z nich je písmeno, které představuje jedno kolo (A – L). Na konci každého kola (v abecedním pořadí písmen) se zavře příslušný zámek, čímž se odstraní šance na získání diamantů v jeho řadě nebo sloupci.</p>
    <p>V každém kole je třeba splnit 4 kroky:
       <ol>
         <li>Na začátku každého kola program automaticky vygeneruje hod 5 kostek</li>
         <li>Poté kliknutím označte pole (čtverečky), která odpovídají hodnotám (nebo jejich kombinaci) na hozených kostkách</li>
         <li>Jakmile použijete všech 5 kostek, dané kolo skončí. Zámek zůstane otevřený nebo se uzamkne v závislosti na tom, zda v daném kole budou u řešeného zámku (v řádku nebo sloupci) označena všechna pole (čtverečky). Pokud ano, hodnota polí daného zámku se změní na znak "o". Aktuálně řešený zámek má podbarvená políčka žlutou barvou, již označená mají hodnotu ve žluté barvě.</li>
         <li>Postup opakujeme až do kola se zámkem „L“, poté hra končí.</li>
       </ol>

  <h3>Označení políček</h3>
    <p>K označení políček, které se nacházejí v Trezoru, nebo políček ve všech třech „Skimmerech“, můžete v daném kole použít libovolný počet nepoužitých hozených kostek (hodnoty můžete sčítat nebo odečítat), jejichž celková hodnota se shoduje s konkrétní číselnou hodnotou na políčku v Trezoru. 
Na některá políčka stačí pouze jedna kostka. Na většině políček v Trezoru je uvedeno číslo. U některých je ale hodnota daná znakem „<b>L</b>“ (lichá), „<b>S</b>“ (sudá) nebo „<b>D</b>“ (double).
Na políčko „Lichá“ nebo „Sudá“ je potřeba pouze „<b>jedna</b>“ kostka, její hodnota pak musí být buď lichá nebo sudá. Nesmíte kombinovat hodnoty dvou kostek tak, aby se rovnala hodnotě třetí kostky.
Na políčko „<b>D</b>“ jsou ale třeba „<b>dvě</b>“ kostky, na hodnotě nezáleží, ale hodnota musí být na obou kostkách „<b>stejná</b>“. Nesmíte kombinovat hodnoty dvou kostek tak, aby se rovnala hodnotě třetí kostky.</p>

  <h3>Skimmery</h3>
    <p>Skimmery jsou zařízení, která jsou používaná k prolamování elektronických trezorů. Nechceme-li nebo nemůžeme-li použít všechny kostky k označení políček v trezoru, můžete kostky použít k nabíjení Skimmeru. Nabíjení Skimmeru umožňuje ukládat nepoužité kostky v daném kole tak, že se jejich hodnoty „<b>sečtou</b>“ a výsledná hodnota se zakreslí do kteréhokoli ze tří Skimmerů. Každou kostku lze použít pouze do jednoho Skimmeru. </p>
    <p>Skimmery můžeme kdykoli v daném kole použít k označení políčka v Trezoru, jako bych měl danou hodnotu Skimmeru na kostce. Můžeme jej  použít samostatně nebo v kombinaci (součet, odečet) s jakoukoli jinou kostkou.<b>Jakmile je Skimmer již jednou použit, nelze do něj již přidávat, ani jej znovu použít.</b></p> 

  <h3>Opakované hody</h3>
    <p>V průběhu hry můžete kdykoli 3x opakovat hod. Při opakovaném hodu můžete použít libovolný počet nepoužitých kostek (1 – 5). <b>Poznámka: Opakovaný hod můžete použít 3x i během svého tahu v jednom kole.</b></p>
  
  <h3>Krádež diamantů</h3>
    <p>Podaří-li se vám v daném kole označit všechna políčka v příslušném sloupci či řádku daného zámku, získáváte tento počet diamantů:
     <ul>
       <li>1 u zámků A, B, C, D, E, F</li>
       <li>2 u zámků G, H, I</li>
       <li>3 u zámků J, K, L</li>
     </ul>
     Poznámka: některé zámky mají více diamantů, z hlediska taktiky je tedy lepší označit dříve políčka ve sloupci či řádku těchto zámků. 
    </p>
    
  <h3>Konec kola</h3>
    <p>Jakmile použijete všechny kostky, kolo končí. </p>
    
  <h3>Konec hry</h3>  
    <p>Hra končí, jakmile dokončíte kolo se zámkem „L“. Program spočítá všechny diamanty u otevřených zámků (za každý 1 bod) a nepoužité Skimmery (za každý 1 bod).
      <ul>
          <li>Jdeš do vězení: méně než 10</li>		  
          <li>Lapka: 10 - 12 </li>
          <li>Kapsář: 13 - 15</li>
          <li>Zloděj: 16 - 18</li>
          <li>Bankovní lupič: 19 - 21</li>
          <li>Arsène Lupin: 22 a více</li>
      </ul>
      <b>Poznámka:</b> v posledních kolech se může stát, že hráč již nebude mít k dispozici žádný Skimmer, opakovaný hod a hodnoty kostek neumožní dokončit standardní cestou kolo. Proto lze kliknutím na tlačítko názvu hry v nabídce vyvolat <b>manuální ukončení daného tahu nebo celé hry</b>.  </p>
      <p>&nbsp;</p>
      <p>&nbsp;</p>
  </div>
</div>

<div id="gameContainer">
  <!-- Označení sloupců nahoře -->
  <div id="letters">
    <div></div><div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A</div><div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;B</div><div></div><div>C</div>
  </div>

  <!-- Označení řádků vlevo a vpravo -->
  <div id="left">
    <div>L</div>
    <div></div>
    <div>K</div>
    <div></div>
    <div>J</div>
    <div></div>
  </div>

  <!-- Hrací deska -->
  <div id="board"></div>

  <div id="right">
    <div></div>
    <div>D</div>
    <div></div>
    <div>E</div>
    <div></div>
    <div>F</div>
  </div>

  <!-- Označení sloupců dole -->
  <div id="bottom">
    <div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I</div><div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;H</div><div></div><div>G</div><div></div>
  </div>

  <!-- Skimmery jako tlačítka -->
  <div id="skimmers">
    <div class="skimmer" onclick="showSkimmerOptions(0)">S1: <span id="skimmer1">0</span>/20</div>&nbsp;
    <div class="skimmer" onclick="showSkimmerOptions(1)">S2: <span id="skimmer2">0</span>/20</div>&nbsp;
    <div class="skimmer" onclick="showSkimmerOptions(2)">S3: <span id="skimmer3">0</span>/20</div>
  </div>
</div>
</br>
<!-- Tlačítka ReRoll -->
<div id="rerolls">
  <button id="reRoll1" onclick="reRollDice(1)" class="reroll-button">Hod 1</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <button id="reRoll2" onclick="reRollDice(2)" class="reroll-button">Hod 2</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <button id="reRoll3" onclick="reRollDice(3)" class="reroll-button">Hod 3</button>
</div>
</br>
<!-- Kostky -->
<div id="diceContainer">
  <div class="die" onclick="toggleDie(0)">1</div>
  <div class="die" onclick="toggleDie(1)">2</div>
  <div class="die" onclick="toggleDie(2)">3</div>
  <div class="die" onclick="toggleDie(3)">4</div>
  <div class="die" onclick="toggleDie(4)">5</div>
</div></br>


<table border="0">
<tr>
<td class="score"></td>
<td class="score" id="score">0</td>
</tr>
<tr>
<td class="highscore"></td>
<td class="highscore" id="high-score">0</td>
<tr>
<td class="highscore"></td>
<td class="highscore" id="final-rating"></td>
</tr>

</tr>
</table>


<!-- Tlačítko pro hod kostkami -->
<!-- <button id="rollButton" onclick="rollDice()">Hod kostkami</button> -->

<script>
function handleButtonClick() {
            // Logika pro zobrazení nápovědy
            const option = prompt(`Hra Trezor - vyberte možnost:\n(zadejte číslo volby)\n1) Zobrazit nápovědu\n2) Ukončit manuálně kolo\n3) Ukončit manuálně hru`);
  if (option === "1") {
    showHelp();
  } else if (option === "2") {
    manualEndRound();
  } else if (option === "3") {
    calculateFinalScore();
    document.getElementById('score').innerText = `Herní deska ${boardId} - počet bodů: ${score}`;
    confirm ("Hra skončila!");
  } else {
    confirm ("Neplatná volba. Zkuste to znovu.");
  }
}


	function selectBoard() {
  const option = prompt(`Hra Trezor - vyberte herní desku:\n(zadejte číslo volby)\n01 - Deska A     07 - Deska G\n02 - Deska B     08 - Deska H\n03 - Deska C     09 - Deska I\n04 - Deska D     10 - Deska J\n05 - Deska E     11 - Deska K\n06 - Deska F     12 - Deska L`);
  if (option === "1" || option === "01") {
    boardLayout = boardLayoutA;
    locks = locksA;  // Definice zamku pro desku A
    boardId = 'A'; // Nastavíme boardId pro desku A
  } else if (option === "2" || option === "02") {
    boardLayout = boardLayoutB;
    locks = locksB;  // Definice zamku pro desku B
    boardId = 'B'; // Nastavíme boardId pro desku B
  } else if (option === "3" || option === "03") {
    boardLayout = boardLayoutC;
    locks = locksB;  // Definice zamku pro desku C - stejna jako pro B
    boardId = 'C'; // Nastavíme boardId pro desku C
  } else if (option === "4" || option === "04") {
    boardLayout = boardLayoutD;
    locks = locksB;  // Definice zamku pro desku D - stejna jako pro B
    boardId = 'D'; // Nastavíme boardId pro desku D
  } else if (option === "5" || option === "05") {
    boardLayout = boardLayoutE;
    locks = locksB;  // Definice zamku pro desku E - stejna jako pro B
    boardId = 'E'; // Nastavíme boardId pro desku E
  } else if (option === "6" || option === "06") {
    boardLayout = boardLayoutF;
    locks = locksF;  //Definice zamku pro desku F
    boardId = 'F'; // Nastavíme boardId pro desku F
  } else if (option === "7" || option === "07") {
    boardLayout = boardLayoutG;
    locks = locksG;  //Definice zamku pro desku G
    boardId = 'G'; // Nastavíme boardId pro desku G
  } else if (option === "8" || option === "08") {
    boardLayout = boardLayoutH;
    locks = locksG;  //Definice zamku pro desku H - stejna jako pro G
    boardId = 'H'; // Nastavíme boardId pro desku H
  } else if (option === "9" || option === "09") {
    boardLayout = boardLayoutI;
    locks = locksG;  //Definice zamku pro desku I - stejna jako pro G
    boardId = 'I'; // Nastavíme boardId pro desku I
  } else if (option === "10") {
    boardLayout = boardLayoutJ;
    locks = locksG;  //Definice zamku pro desku J - stejna jako pro G
    boardId = 'J'; // Nastavíme boardId pro desku J
	} else if (option === "11") {
    boardLayout = boardLayoutK;
    locks = locksG;  //Definice zamku pro desku K - stejna jako pro G
    boardId = 'K'; // Nastavíme boardId pro desku K
	} else if (option === "12") {
    boardLayout = boardLayoutL;
    locks = locksG;  //Definice zamku pro desku L - stejna jako pro G
    boardId = 'L'; // Nastavíme boardId pro desku L
  } else {
    confirm("Neplatná volba. Zkuste to znovu.");
    selectBoard(); // Opakování výběru
  }
}



// Otevření modálního okna
function showHelp() {
  document.getElementById('helpModal').style.display = 'block';
}

function closeHelp() {
  document.getElementById('helpModal').style.display = 'none';
}

// Zavření modálního okna, když uživatel klikne mimo něj
window.onclick = function(event) {
  if (event.target == document.getElementById('helpModal')) {
    document.getElementById('helpModal').style.display = 'none';
  }
}



  const boardLayoutA = [

    ['20', 'x', '6', '15', '4', '13', '12'],
    ['x', '7', '2', 'S', 'x', '5', 'x'],
    ['10', '11', 'L', 'x', 'D', '9', '6'],
    ['x', '14', 'x', '5', 'x', '3', '2'],
    ['9', '15', '4', 'D', '3', 'x', '4'],
    ['x', '12', 'x', '6', '5', '10', 'x']
  ];


  const boardLayoutB = [

    ['19', 'x', '5', '14', '6', '13', 'x'],
    ['x', '7', '1', 'x', 'x', '3', 'x'],
    ['8', 'D', 'x', 'x', '10', '8', '4'],
    ['x', '14', 'x', '4', 'x', 'x', '6'],
    ['9', '16', 'S', '12', 'x', 'x', '1'],
    ['x', 'x', 'x', '3', '5', '11', 'x']
 ];


  const boardLayoutC = [

    ['19', 'x', '5', '17', '6', '13', 'x'],
    ['x', '8', '6', 'x', 'x', 'L', 'x'],
    ['10', '11', 'x', 'x', '10', '7', '6'],
    ['x', '16', 'x', '1', 'x', 'x', 'L'],
    ['D', '13', '4', '7', 'x', 'x', '3'],
    ['x', 'x', 'x', '5', 'S', '10', 'x']
 ];


  const boardLayoutD = [

    ['19', 'x', 'S', '13', '1', '14', 'x'],
    ['x', '9', '2', 'x', 'x', '1', 'x'],
    ['11', '8', 'x', 'x', '12', '9', '1'],
    ['x', '17', 'x', '6', 'x', 'x', '5'],
    ['7', '15', '6', '12', 'x', 'x', '2'],
    ['x', 'x', 'x', '1', '3', '7', 'x']
 ];


  const boardLayoutE = [

    ['21', 'x', '2', '18', '5', '14', 'x'],
    ['x', '8', '6', 'x', 'x', 'S', 'x'],
    ['9', '7', 'x', 'x', '8', '6', '2'],
    ['x', '18', 'x', '1', 'x', 'x', '4'],
    ['10', '16', '2', '9', 'x', 'x', '3'],
    ['x', 'x', 'x', 'L', '4', '11', 'x']
 ];


  const boardLayoutF = [

    ['23', 'x', '4', '14', 'L', '16', '7'],
    ['x', '8', 'S', 'x', 'x', 'L', 'x'],
    ['10', '9', 'x', 'x', '12', '7', '3'],
    ['x', '14', 'x', '6', 'x', '4', '1'],
    ['7', '15', 'L', '11', '3', 'x', '6'],
    ['x', 'x', 'x', '1', '2', '9', 'x']
 ];

  const boardLayoutG = [

    ['19', 'x', '2', '17', '3', '18', '12'],
    ['x', '12', '5', 'S', 'x', '1', 'x'],
    ['7', '10', '1', 'x', '9', '11', '2'],
    ['x', '15', 'x', 'L', 'x', '6', '1'],
    ['D', '16', 'S', '11', '3', 'x', '4'],
    ['x', '10', 'x', '3', '2', 'D', 'x']
 ];


  const boardLayoutH = [

    ['23', 'x', '6', '17', 'L', '16', '12'],
    ['x', 'D', 'L', '3', 'x', 'S', 'x'],
    ['8', '14', '1', 'x', '11', '12', '6'],
    ['x', '9', 'x', 'L', 'x', '3', '4'],
    ['11', '15', '2', '10', '1', 'x', '5'],
    ['x', '8', 'x', '1', '4', '7', 'x']
 ];



  const boardLayoutI = [

    ['20', 'x', '6', '15', '4', '13', '12'],
    ['x', '7', '2', 'S', 'x', '5', 'x'],
    ['10', '11', 'L', 'x', 'D', '9', '6'],
    ['x', '14', 'x', '5', 'x', '3', '2'],
    ['9', '15', '4', 'D', '3', 'x', '4'],
    ['x', '12', 'x', '6', '5', '10', 'x']
 ];


  const boardLayoutJ = [

    ['23', 'x', '6', '14', '1', '15', '12'],
    ['x', '10', '2', '5', 'x', '3', 'x'],
    ['8', '14', '1', 'x', '7', '10', 'L'],
    ['x', '8', 'x', '3', 'x', '2', '1'],
    ['9', '16', '3', '12', 'L', 'x', '4'],
    ['x', 'D', 'x', '4', 'S', '9', 'x']
 ];


  const boardLayoutK = [

    ['22', 'x', '2', '14', '5', '16', 'D'],
    ['x', '7', '4', '2', 'x', 'L', 'x'],
    ['8', '16', '3', 'x', '7', '11', 'L'],
    ['x', 'D', 'x', '6', 'x', '3', '2'],
    ['9', '17', '1', 'D', '1', 'x', '6'],
    ['x', '8', 'x', 'S', '2', '12', 'x']
 ];

  const boardLayoutL = [

    ['19', 'x', '5', '17', '3', '14', 'D'],
    ['x', '8', '3', '4', 'x', '1', 'x'],
    ['7', '13', '1', 'x', '10', '11', '3'],
    ['x', 'D', 'x', '1', 'x', '5', '4'],
    ['10', '16', '3', 'D', 'L', 'x', '1'],
    ['x', '10', 'x', '6', '4', '12', 'x']
 ];




let dice = [0, 0, 0, 0, 0]; // Hodnoty kostek
let skimmers = [0, 0, 0]; // Hodnoty pro skimmery
let selectedDice = []; // Uchování vybraných kostek
let currentRound = 1; // Aktuální kolo
let score = 0; // Body hráče
let unusedSkimmers = 0; // Pocet nepouzitychžitých Skimmerů
const totalRounds = 12; // Počet kol

const locksA = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 3, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 

const locksB = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }] }
]; 

const locksF = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 


const locksG = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 3, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 


const lockPoints = { A: 1, B: 1, C: 1, D: 1, E: 1, F: 1, G: 2, H: 2, I: 2, J: 3, K: 3, L: 3 }; // Body za zámky


  // Vytvoření herní desky
  function createBoard() {
    const boardDiv = document.getElementById('board');
    for (let row = 0; row < boardLayout.length; row++) {
      for (let col = 0; col < boardLayout[row].length; col++) {
        const cellValue = boardLayout[row][col];
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.id = `cell-${row}-${col}`;
        cell.innerText = cellValue;

        if (cellValue === 'x') {
          cell.classList.add('disabled');
        } else {
          cell.onclick = () => markCell(row, col, cellValue); 
        }

        if (cellValue === 'L') cell.classList.add('odd');
        else if (cellValue === 'S') cell.classList.add('even');
        else if (cellValue === 'D') cell.classList.add('double');

        boardDiv.appendChild(cell);
      }
    }
  }


function loadHighScore(boardId) {
  const savedScore = localStorage.getItem(`highScore_${boardId}`);
  console.log(`Načítání nejvyššího skóre pro desku ${boardId}:`, savedScore); // Přidáno logování
  return savedScore ? parseInt(savedScore, 10) : 0;
}

function saveHighScore(score, boardId) {
  localStorage.setItem(`highScore_${boardId}`, score);
  console.log(`Ukládání nového nejvyššího skóre pro desku ${boardId}:`, score); // Přidáno logování
}



// Funkce pro získání skutečné barvy pozadí elementu
function getBackgroundColor(element) {
    return window.getComputedStyle(element, null).getPropertyValue('background-color');
}

// Funkce pro hod kostkami
function rollDice() {
  dice = Array.from({ length: 5 }, () => Math.floor(Math.random() * 6) + 1);
  const diceElements = document.querySelectorAll('.die');
  dice.forEach((value, index) => {
    diceElements[index].innerText = value;
    diceElements[index].classList.remove('clicked', 'used'); // Reset označení kostek při hodu
  });
  selectedDice = []; // Reset vybraných kostek při hodu
}

// Funkce pro zahájení nového kola
function startRound() {
      // Vyčištění předchozího zvýraznění
  locks.forEach(lock => {
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.remove('highlight-empty', 'highlight-filled');
      cell.style.color = ''; // Resetuje barvu textu
      cell.style.fontWeight = ''; // Resetuje tucnečné pismo textu
    });
  });
const currentLock = locks[currentRound - 1];
const lockName = currentLock.name;

// Zvýraznění aktuálního zámku
  currentLock.coordinates.forEach(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    const backgroundColor = getBackgroundColor(cell);
    if (backgroundColor === 'rgb(75, 76, 75)') {
            // Pokud je barva pozadí buňky šedá (rgb(128, 128, 128))
            
            cell.style.color = 'yellow'; // Nastavení žluté barvy textu pro buňky s šedým pozadím
            cell.style.fontWeight = 'bold'; // Nastavení tučného písma pro buňky s šedým pozadím
        } else {
            // Pokud je buňka nevyplněná
            cell.classList.add('highlight-empty');
        }
    
    
   
  });
  if (currentRound > totalRounds) {
    confirm ("Hra skončila!");
    return;
  }
  confirm (`Zahajuje se kolo ${currentRound}: Řešíme zámek ${currentLock.name}`);
}



// Kontrola, zda byly všechny kostky použity
function checkAllDiceUsed() {
  const allUsed = Array.from(document.querySelectorAll('.die')).every(die => die.classList.contains('used'));
  if (allUsed) {
    endRound();
  }
}


function getRating(score) {
  if (score < 10) {
    return "Jdeš do vězení";
  } else if (score <= 12) {
    return "Lapka&nbsp;&nbsp;&#11088;";
  } else if (score <= 15) {
    return "Kapsář&nbsp;&nbsp;&#11088;&#11088;";
  } else if (score <= 18) {
    return "Zloděj&nbsp;&nbsp;&#11088;&#11088;&#11088;";
  } else if (score <= 21) {
    return "Bankovní lupič&nbsp;&nbsp;&#11088;&#11088;&#11088;&#11088;";
  } else {
    return "Arsène Lupin&nbsp;&nbsp;&#11088;&#11088;&#11088;&#11088;&#11088;";
  }
}


// Funkce pro výpočet závěrečného skóre včetně nepoužitých skimmerů
function calculateFinalScore() {
  let unusedSkimmers = 0;

  document.querySelectorAll('.skimmer').forEach((skimmer) => {
    if (!skimmer.classList.contains('disabled')) {
      unusedSkimmers++;
    }
  });

  // Přičtení bodů za nepoužité skimmery
  score += unusedSkimmers;

  confirm(`Konečné skóre: ${score} (zahrnuje počet bodů za nepoužité Skimmery : ${unusedSkimmers})`);
	// Výpočet hodnocení na základě skóre
  const rating = getRating(score);
 document.getElementById('final-rating').innerHTML = `Hodnocení: ${rating}`;


  // Načtěte nejvyšší skóre pro aktuální desku
  const highScore = loadHighScore(boardId);
  console.log(`Porovnání aktuálního skóre ${score} s nejvyšším skóre ${highScore} pro desku ${boardId}`);

  if (score > highScore) {
    saveHighScore(score, boardId);
    confirm(`Gratulujeme! Dosáhli jste nového vysokého skóre: ${score}`);

  // Aktualizujeme skóre na obrazovce
  document.getElementById('score').innerText = `Herní deska ${boardId} - počet bodů: ${score}`;

  }
}


// Funkce pro manuální ukončení kola, pokud nelze použít všechny kostky
function manualEndRound() {
  const lock = locks[currentRound - 1];

  // Zkontrolujeme, zda jsou všechny relevantní buňky pro tento zámek vyplněny
  const allCellsFilled = lock.coordinates.every(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    return cell.classList.contains('clicked');
  });

  if (allCellsFilled) {
    // Označíme všechny buňky tohoto zámku jako 'O' v herní desce
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.add('opened'); // Přidáme třídu 'opened' pro vizuální označení
      cell.textContent = 'o'; // Změníme obsah buňky na 'o'
    });
    score += lockPoints[lock.name];
    confirm(`Zámek ${lock.name} zůstává otevřený, počet získaných diamantů: ${lockPoints[lock.name]}.`);
  } else {
    confirm(`Zámek ${lock.name} se uzamknul.`);
  }

  // Aktualizujeme skóre na obrazovce
  document.getElementById('score').innerText = `Herní deska ${boardId} - počet bodů: ${score}`;

  // Posun na další kolo
  currentRound++;
  if (currentRound <= locks.length) {
    rollDice();       // Zahájení nového kola s novým hodem
    startRound();     // Připraví hrací desku na nové kolo
  } else {
    calculateFinalScore(); // Pokud je poslední kolo, spočítá závěrečné skóre
    confirm("Hra skončila!");
  }
}




// Funkce pro ukončení kola, pokud jsou použity všechny kostky
function endRound() {
  // Zkontrolujeme, zda jsou všechny relevantní buňky pro tento zámek vyplněny
  const lock = locks[currentRound - 1];
  const allCellsFilled = lock.coordinates.every(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    return cell.classList.contains('clicked');
  });

  if (allCellsFilled) {
      
   // Označíme všechny buňky tohoto zámku jako 'O' v herní desce
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.add('opened'); // Přidáme třídu 'opened' pro vizuální označení
      cell.textContent = 'o'; // Změníme obsah buňky na 'o'
    });   
      
    score += lockPoints[lock.name];
    confirm (`Zámek ${lock.name} zůstává otevřený, počet získaných diamantů: ${lockPoints[lock.name]}.`);
  } else {
    confirm (`Zámek ${lock.name} se uzamknul.`);
  }



  // Posun na další kolo a nový hod kostkami
  currentRound++;
  if (currentRound <= locks.length) {
  	document.getElementById('score').innerText = `Herní deska ${boardId} - počet bodů: ${score}`;
    rollDice();
    startRound();
   
  } else {
   
    calculateFinalScore();
   	document.getElementById('score').innerText = `Herní deska ${boardId} - počet bodů: ${score}`;
    confirm ("Hra skončila!");
  }
}



// Aktualizace tlačítek ReRoll
  function updateReRollButtons() {
    const isAnyDieSelected = selectedDice.some(selected => selected);
    const reRollButtons = document.querySelectorAll('.reroll-button');
    reRollButtons.forEach(button => {
      button.classList.toggle('disabled', !isAnyDieSelected);
    });
  }

  // Možnost opakovaného hodu
function reRollDice(rerollIndex) {
  if (selectedDice.length > 0) {    
  const diceElements = document.querySelectorAll('.die:not(.used).clicked');
  diceElements.forEach((die, index) => {
    const newRoll = Math.floor(Math.random() * 6) + 1; // Nová hodnota od 1 do 6
    die.innerText = newRoll;
    die.classList.remove('clicked'); // Reset kliknutí po hodu

    // Aktualizace pole dice pro tuto kostku
    const dieIndex = Array.from(document.querySelectorAll('.die')).indexOf(die);
    dice[dieIndex] = newRoll;
  });

  // Reset pole selectedDice, aby obsahovalo pouze nové hodnoty
  selectedDice = []; // Tím zajistíme, že se staré hodnoty nepřičítají
  const button = document.getElementById(`reRoll${rerollIndex}`);
  button.classList.add('disabled');
  button.onclick = null; // Zamezení opětovnému kliknutí
  } else {
    confirm ("Vyberte alespoň jednu kostku pro opakovaný hod.");
  }
}

function showSkimmerOptions(index) {
  const skimmerName = `Skimmer ${index + 1}`;
  const option = prompt(`Vybrali jste ${skimmerName}\nVyberte možnost:\n(zadejte číslo volby)\n1) Uložit do něj hodnoty kostek \n2) Použít ho jako další kostku`);
  if (option === "1") {
    addDiceToSkimmer(index);
  } else if (option === "2") {
    useSkimmerAsDie(index);
  } else {
    confirm ("Neplatná volba. Zkuste to znovu.");
  }
}

// Přidání vybraných kostek do skimmeru
function addDiceToSkimmer(index) {
  if (document.querySelectorAll('.skimmer')[index].classList.contains('disabled')) {
    confirm ("Tento Skimmer již nelze použít.");
    return;
  }  
  if (selectedDice.length > 0) {
    // Součet hodnot vybraných kostek
    const diceSum = selectedDice.reduce((a, b) => a + b, 0);
    const remainingCapacity = 20 - skimmers[index];

    // Kontrola, zda vybrané kostky nepřesahují zbývající kapacitu skimmeru
    if (diceSum > remainingCapacity) {
      confirm (`Nelze přidat: hodnota kostek ${diceSum} překračuje zbývající kapacitu skimmeru ${remainingCapacity}.`);
    } else {
      // Přidání kostek do skimmeru a aktualizace UI
      skimmers[index] += diceSum;
      document.getElementById(`skimmer${index + 1}`).innerText = skimmers[index];

      // Označení vybraných kostek jako použitých
      document.querySelectorAll('.die.clicked').forEach(die => {
        die.classList.add('used');
        die.classList.remove('clicked');
	document.querySelectorAll('.cell').forEach(cell => {
			cell.classList.remove('highlight'); // Odstraníme staré zvýraznění
		  });
      });

      selectedDice = []; // Reset vybraných kostek po přenosu

      // Zkontrolovat, zda byly použity všechny kostky
      checkAllDiceUsed();
    }
  } else {
    confirm ("Vyberte alespoň jednu kostku pro přesun do skimmeru.");
  }
}

function useSkimmerAsDie(index) {
  if (skimmers[index] > 0) {
    selectedDice.push(skimmers[index]);
    document.querySelectorAll('.skimmer')[index].classList.add('disabled');
    document.querySelectorAll('.skimmer')[index].onclick = null; // Zamezení opětovnému použití skimmeru
    confirm (`Vybrali jste Skimmer ${index + 1}\nByl použit jako kostka\ns hodnotou ${skimmers[index]}.\nVyber pole na hrací desce,\npřípadně zkombinuj s jinou kostkou.`);
	document.querySelectorAll('.cell').forEach(cell => {
			cell.classList.remove('highlight'); // Odstraníme staré zvýraznění
	// Zvýraznění políček na hrací desce, které odpovídají některému z možných součtů nebo rozdílů
		  document.querySelectorAll('.cell').forEach(cell => {
			const cellValue = cell.innerText;

	if (skimmers.includes(parseInt(cellValue)) // Přidání podmínky pro skimmery
			) {
		console.log(`Zvýrazněno pole: (${cell.id}) s hodnotou ${cellValue}`);
			  cell.classList.add('highlight',); // Zvýrazníme políčko, pokud odpovídá hodnotě nebo kombinaci kostek
			}})
		  });

  } else {
    confirm ("Hodnota Skimmeru musí být minimálně 1.");
  }
}

		// Přidání funkce pro zvýraznění možných polí na základě vybraných kostek
		function highlightPossibleCells() {
		const skimmers = [0, 0, 0]; // Příklad hodnot skimmerů
		  // Nejprve reset všech zvýrazněných políček
		  document.querySelectorAll('.cell').forEach(cell => {
			cell.classList.remove('highlight'); // Odstraníme staré zvýraznění
		  });

		  if (selectedDice.length === 0) return; // Pokud není vybrána žádná kostka, vrátíme se

		  // Vygenerování všech možných součtů a rozdílů pro vybrané kostky
		  const possibleSumsAndDiffs = generatePossibleSumsAndDiffs(selectedDice);

	 console.log("Vybrané kostky:", selectedDice);
	  console.log("Možné součty a rozdíly:", possibleSumsAndDiffs);

		  // Zvýraznění políček na hrací desce, které odpovídají některému z možných součtů nebo rozdílů
		  document.querySelectorAll('.cell').forEach(cell => {
			const cellValue = cell.innerText.trim();  // Zajišťujeme, že odstraňujeme případné mezery
			const cellBackgroundColor = window.getComputedStyle(cell).backgroundColor;
			
			
			// Zkontrolujeme, zda je cellValue číslo, pokud je to text (L, S, D)
			const cellNumericValue = parseInt(cellValue);

			if (
			  (cellValue === 'L' && selectedDice.length === 1 && selectedDice[0] % 2 !== 0) ||
			  (cellValue === 'S' && selectedDice.length === 1 && selectedDice[0] % 2 === 0) ||
			  (cellValue === 'D' && selectedDice.length === 2 && selectedDice[0] === selectedDice[1]) ||
			  possibleSumsAndDiffs.has(parseInt(cellValue)) ||
			  skimmers.includes(parseInt(cellValue))// Přidání podmínky pro skimmery
			) {
		console.log(`Zvýrazněno pole: (${cell.id}) s hodnotou ${cellValue}`);
			  cell.classList.add('highlight',); // Zvýrazníme políčko, pokud odpovídá hodnotě nebo kombinaci kostek
			}
		  });
		}





// Vygenerování všech možných součtů a rozdílů z vybraných kostek
function generatePossibleSumsAndDiffs(diceArray) {
  const results = new Set();
  
  function calculateCombinations(dice, currentSum, currentDiff) {
    if (dice.length === 0) {
      results.add(currentSum);
      results.add(Math.abs(currentDiff));
      return;
    }

    for (let i = 0; i < dice.length; i++) {
      const remainingDice = dice.slice(0, i).concat(dice.slice(i + 1));
      calculateCombinations(remainingDice, currentSum + dice[i], currentDiff + dice[i]);
      calculateCombinations(remainingDice, currentSum - dice[i], currentDiff - dice[i]);
    }
  }

  calculateCombinations(diceArray, 0, 0);
console.log("Vygenerované kombinace součtů a rozdílů:", results);
  return results;
}

function toggleDie(index) {
  const die = document.querySelectorAll('.die')[index];
  const dieValue = dice[index];
  if (!die.classList.contains('used')) { // Pouze pokud kostka nebyla použita
    die.classList.toggle('clicked');
    if (die.classList.contains('clicked')) {
      selectedDice.push(index); // Přidáme index kostky
    } else {
      selectedDice = selectedDice.filter(i => i !== index); // Odebrání indexu kostky
    }
	highlightPossibleCells(); // Aktualizace zvýraznění polí po změně výběru kostek
  }
}

  // Přepnutí stavu kostky (označení/odznačení) a přidání/odebrání její hodnoty do/z vybraných kostek
  function toggleDie(index) {
    const die = document.querySelectorAll('.die')[index];
    const dieValue = dice[index];

    if (!die.classList.contains('used')) { // Kostku lze vybrat, pouze pokud nebyla použita
      die.classList.toggle('clicked');

      if (die.classList.contains('clicked')) {
        selectedDice.push(dieValue); // Přidat hodnotu kostky do vybraných
      } else {
        selectedDice = selectedDice.filter(value => value !== dieValue); // Odebrat hodnotu kostky
      }
	  highlightPossibleCells(); // Aktualizace zvýraznění polí po změně výběru kostek
    }
  }

// Funkce pro označení políčka na desce podle pravidel pro 'L', 'S' a 'D'
function markCell(row, col, cellValue) {
  const cell = document.getElementById(`cell-${row}-${col}`);
  
  // Podmínky pro jednotlivé kombinace kostek
  const isSingleOdd = selectedDice.length === 1 && selectedDice[0] % 2 !== 0;
  const isSingleEven = selectedDice.length === 1 && selectedDice[0] % 2 === 0;
  const isDoubleSame = selectedDice.length === 2 && selectedDice[0] === selectedDice[1];

  // Funkce pro generování všech možných součtů a rozdílů z vybraných kostek
  function generatePossibleSumsAndDiffs(diceArray) {
    const results = new Set();
    
    // Rekurzivní funkce pro generování všech kombinací sčítání a odečítání
    function calculateCombinations(dice, currentSum, currentDiff) {
      if (dice.length === 0) {
        results.add(currentSum); // Přidáme součet
        results.add(Math.abs(currentDiff)); // Přidáme rozdíl
        return;
      }

      // Pro každou kostku, rozhodneme, zda ji přičteme nebo odečteme
      for (let i = 0; i < dice.length; i++) {
        const remainingDice = dice.slice(0, i).concat(dice.slice(i + 1));

        // Představuje možnost přičíst aktuální kostku
        calculateCombinations(remainingDice, currentSum + dice[i], currentDiff + dice[i]);
        
        // Představuje možnost odečíst aktuální kostku
        calculateCombinations(remainingDice, currentSum - dice[i], currentDiff - dice[i]);
      }
    }

    // Začneme rekurzivní výpočty pro všechny kostky
    calculateCombinations(diceArray, 0, 0);

    return results;
  }

  // Vygeneruj všechny možné součty a rozdíly
  const possibleSumsAndDiffs = generatePossibleSumsAndDiffs(selectedDice);

  // Zkontroluj, jestli hodnota buňky odpovídá některému z možných součtů nebo rozdílů
  if (
    (cellValue === 'L' && isSingleOdd) ||
    (cellValue === 'S' && isSingleEven) ||
    (cellValue === 'D' && isDoubleSame) ||
    possibleSumsAndDiffs.has(parseInt(cellValue)) // Zkontroluj, jestli je hodnota v seznamu možných součtů a rozdílů
  ) {
    cell.classList.add('clicked'); // Označení políčka jako "kliknuté"
	document.querySelectorAll('.cell').forEach(cell => {
		cell.classList.remove('highlight'); // Odstraníme staré zvýraznění
	  });
    // Označení vybraných kostek jako použitých a odstranění jejich výběru
    document.querySelectorAll('.die.clicked').forEach(die => {
      die.classList.add('used');
      die.classList.remove('clicked');
    });

    selectedDice = []; // Reset vybraných kostek po použití

    // Zkontrolovat, zda byly použity všechny kostky
    checkAllDiceUsed();
  } else {
    confirm ("Hodnota kostek neodpovídá požadavkům na toto pole.");
  }
}

function startGame() {
  currentRound = 1;
  score = 0;
  rollDice();
  startRound();
  document.getElementById('score').innerText = `Herní deska ${boardId} - počet bodů: ${score}`;
  
// Ověřte, že boardId je nastavené před načítáním skóre
  if (boardId) {
    const highScore = loadHighScore(boardId);
    document.getElementById('high-score').innerText = `Herní deska ${boardId} - nejvyšší dosažené skóre: ${highScore}`;
  } else {
    console.error("boardId není definováno při načítání skóre");
  }
}


	// Inicializace hry
	function initGame() {
	  selectBoard(); // umožní výběr desky
	  createBoard(); // vytvoří vybranou desku
	  startGame();   // zahájí hru s vybranou deskou
	}


initGame();


</script>
</body>
</html>

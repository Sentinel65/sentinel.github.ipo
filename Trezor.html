<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hra Trezor</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
    }
    #gameContainer {
      display: grid;
      grid-template-areas: 
        "letters letters letters"
        "left board right"
        "bottom bottom bottom"
        "skimmers skimmers skimmers";
      gap: 10px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-gap: 5px;
      justify-content: center;
      margin: 10px;
      grid-area: board;
    }
    .cell {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #000;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
    }
    .cell.clicked { background-color: gray; color: #fff;cursor: not-allowed;pointer-events: none;} /* Styl označených políček */
    .disabled { background-color: #000; cursor: default; } /* Nehratelná políčka */
    .used { background-color: #d3d3d3; cursor: default; color: #333; } /* Styl použitých kostek */
    .odd { background-color: #e0ffe0; } /* Lichá čísla */
    .even { background-color: #e0e0ff; } /* Sudá čísla */
    .double { background-color: #ffe0e0; } /* Double */
    #letters, #left, #right, #bottom {
      display: grid;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
    }
    #letters {
      grid-template-columns: repeat(7, 1fr);
      grid-area: letters;
	  margin-right: 30px;
    }
    #left {
      grid-template-rows: repeat(6, 1fr);
      grid-area: left;
      justify-content: end;
      margin-top: 28px;
    }
    #right {
      grid-template-rows: repeat(6, 1fr);
      grid-area: right;
      margin-top: 28px;
    }
    #bottom {
      grid-template-columns: repeat(7, 1fr);
      grid-area: bottom;
	  margin-right: 18px;
    }
    #skimmers {
      grid-area: skimmers;
      display: flex;
      justify-content: center;
      gap: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }
    .score {
    font-size: 16px;
    font-weight: bold;
    }
    .highscore {
    font-size: 16px;
    font-weight: bold;
    }
    .skimmer {
      padding: 5px 10px;
      border: 2px solid #333;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
    }
    .skimmer.clicked { background-color: #ffcccb; } /* Styl označených skimmerů */
    #diceContainer {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .skimmer.disabled {
  background-color: #d3d3d3;
  color: #888;
  cursor: not-allowed;
  border-color: #888;
}
    
      /* Stylování pro tlačítka nápovědy  */
  .help-button {
    padding: 5px 10px;
    border: 2px solid #333;
    border-radius: 5px;
    cursor: pointer;
    background-color: #add8e6;
    font-size: 16px;
    font-weight: bold;
    user-select: none;
  }
    
      /* Stylování pro tlačítka ReRoll */
  .reroll-button {
    padding: 5px 10px;
    border: 2px solid #333;
    border-radius: 5px;
    cursor: pointer;
    background-color: #add8e6;
    font-size: 14px;
    font-weight: bold;
    user-select: none;
  }

  /* Styl pro deaktivovaná tlačítka */
  .reroll-button.disabled {
    background-color: #d3d3d3;
    color: #888;
    cursor: not-allowed;
    border-color: #888;
  }
  
  .highlight-empty {
  background-color: yellow;
  color: black;
  font-weight: bold;
}

  .highlight-filled {
  background-color: gray;
  color: yellow;
  font-weight: bold;
}
    .die {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #333;
      border-radius: 5px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }
    .die.clicked { background-color: #90cfff; } /* Styl označených kostek */
    #rollButton {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      .cell, .die {
        width: 30px;
        height: 30px;
        font-size: 12px;
      }
      #letters, #left, #right, #bottom, #skimmers {
        font-size: 14px;
      }
      .skimmer { padding: 5px; }
    }
    /* Modální okno */
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  padding-top: 60px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0,0,0);
  background-color: rgba(0,0,0,0.4);
}

/* Obsah modálního okna */
.modal-content {
  background-color: #fefefe;
  margin: 5% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* Tlačítko pro zavření modálního okna */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
  </style>
</head>
<body>


<button id="helpButton" class="help-button" onclick="handleButtonClick()">Hra Trezor</button>
</br>
<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeHelp()">&times;</span>
  <h2>TREZOR</h2>
    <p>Kostková solitaire hra.</p>
    <p>Ve hře představujete bankovního lupiče, který se snaží prolomit specializovaný trezor. Pomocí hodu kostkami a pečlivého plánování doufáte, že se vám podaří dostat ven s co největším počtem diamantů dříve, než se všechny zámky na trezoru zavřou. Některé zámky obsahují více diamantů než jiné, takže je na vás, abyste se rozhodli, na kterém zámku strávíte svůj čas s ohledem na hozené hodnoty na kostkách.</p>
  <h3>Průběh hry</h3>
    <p>Trezor, který se snažíte rozlousknout, má 12 zámků, na každém z nich je písmeno, které představuje jedno kolo (A – L). Na konci každého kola (v abecedním pořadí písmen) se zavře příslušný zámek, čímž se odstraní šance na získání diamantů v jeho řadě nebo sloupci.</p>
    <p>V každém kole je třeba splnit 4 kroky:
       <ol>
         <li>Na začátku každého kola program automaticky vygeneruje hod 5 kostek</li>
         <li>Poté kliknutím označte pole (čtverečky), která odpovídají hodnotám (nebo jejich kombinaci) na hozených kostkách</li>
         <li>Jakmile použijete všech 5 kostek, dané kolo skončí. Zámek zůstane otevřený nebo se uzamkne v závislosti na tom, zda v daném kole budou u řešeného zámku (v řádku nebo sloupci) označena všechna pole (čtverečky). Pokud ano, hodnota polí daného zámku se změní na znak "o". Aktuálně řešený zámek má podbarvená políčka žlutou barvou, již označená mají hodnotu ve žluté barvě.</li>
         <li>Postup opakujeme až do kola se zámkem „L“, poté hra končí.</li>
       </ol>

  <h3>Označení políček</h3>
    <p>K označení políček, které se nacházejí v Trezoru, nebo políček ve všech třech „Skimmerech“, můžete v daném kole použít libovolný počet nepoužitých hozených kostek (hodnoty můžete sčítat nebo odečítat), jejichž celková hodnota se shoduje s konkrétní číselnou hodnotou na políčku v Trezoru. 
Na některá políčka stačí pouze jedna kostka. Na většině políček v Trezoru je uvedeno číslo. U některých je ale hodnota daná znakem „<b>L</b>“ (lichá), „<b>S</b>“ (sudá) nebo „<b>D</b>“ (double).
Na políčko „Lichá“ nebo „Sudá“ je potřeba pouze „<b>jedna</b>“ kostka, její hodnota pak musí být buď lichá nebo sudá. Nesmíte kombinovat hodnoty dvou kostek tak, aby se rovnala hodnotě třetí kostky.
Na políčko „<b>D</b>“ jsou ale třeba „<b>dvě</b>“ kostky, na hodnotě nezáleží, ale hodnota musí být na obou kostkách „<b>stejná</b>“. Nesmíte kombinovat hodnoty dvou kostek tak, aby se rovnala hodnotě třetí kostky.</p>

  <h3>Skimmery</h3>
    <p>Skimmery jsou zařízení, která jsou používaná k prolamování elektronických trezorů. Nechceme-li nebo nemůžeme-li použít všechny kostky k označení políček v trezoru, můžete kostky použít k nabíjení Skimmeru. Nabíjení Skimmeru umožňuje ukládat nepoužité kostky v daném kole tak, že se jejich hodnoty „<b>sečtou</b>“ a výsledná hodnota se zakreslí do kteréhokoli ze tří Skimmerů. Každou kostku lze použít pouze do jednoho Skimmeru. </p>
    <p>Skimmery můžeme kdykoli v daném kole použít k označení políčka v Trezoru, jako bych měl danou hodnotu Skimmeru na kostce. Můžeme jej  použít samostatně nebo v kombinaci (součet, odečet) s jakoukoli jinou kostkou.<b>Jakmile je Skimmer již jednou použit, nelze do něj již přidávat, ani jej znovu použít.</b></p> 

  <h3>Opakované hody</h3>
    <p>V průběhu hry můžete kdykoli 3x opakovat hod. Při opakovaném hodu můžete použít libovolný počet nepoužitých kostek (1 – 5). <b>Poznámka: Opakovaný hod můžete použít 3x i během svého tahu v jednom kole.</b></p>
  
  <h3>Krádež diamantů</h3>
    <p>Podaří-li se vám v daném kole označit všechna políčka v příslušném sloupci či řádku daného zámku, získáváte tento počet diamantů:
     <ul>
       <li>1 u zámků A, B, C, D, E, F</li>
       <li>2 u zámků G, H, I</li>
       <li>3 u zámků J, K, L</li>
     </ul>
     Poznámka: některé zámky mají více diamantů, z hlediska taktiky je tedy lepší označit dříve políčka ve sloupci či řádku těchto zámků. 
    </p>
    
  <h3>Konec kola</h3>
    <p>Jakmile použijete všechny kostky, kolo končí. </p>
    
  <h3>Konec hry</h3>  
    <p>Hra končí, jakmile dokončíte kolo se zámkem „L“. Program spočítá všechny diamanty u otevřených zámků (za každý 1 bod) a nepoužité Skimmery (za každý 1 bod).
      <ul>
          <li>Jdeš do vězení: méně než 10</li>
          <li>Kapsář: 10 - 12 </li>
          <li>Chmaták: 13 - 15</li>
          <li>Zloděj: 16 - 18</li>
          <li>Bankovní lupič: 19 - 21</li>
          <li>Arsene Lupin: 22 a více</li>
      </ul>
      <b>Poznámka:</b> v posledních kolech se může stát, že hráč již nebude mít k dispozici žádný Skimmer, opakovaný hod a hodnoty kostek neumožní dokončit standardní cestou kolo. Proto lze kliknutím na tlačítko názvu hry v nabídce vyvolat <b>manuální ukončení hry</b>.  </p>
      <p>&nbsp;</p>
      <p>&nbsp;</p>
  </div>
</div>
<!--<h3>Vault Game</h3>  -->

<div id="gameContainer">
  <!-- Označení sloupců nahoře -->
  <div id="letters">
    <div></div><div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A</div><div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;B</div><div></div><div>C</div>
  </div>

  <!-- Označení řádků vlevo a vpravo -->
  <div id="left">
    <div>L</div>
    <div></div>
    <div>K</div>
    <div></div>
    <div>J</div>
    <div></div>
  </div>

  <!-- Hrací deska -->
  <div id="board"></div>

  <div id="right">
    <div></div>
    <div>D</div>
    <div></div>
    <div>E</div>
    <div></div>
    <div>F</div>
  </div>

  <!-- Označení sloupců dole -->
  <div id="bottom">
    <div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I</div><div></div><div>&nbsp;&nbsp;&nbsp;&nbsp;H</div><div></div><div>G</div><div></div>
  </div>

  <!-- Skimmery jako tlačítka -->
  <div id="skimmers">
    <div class="skimmer" onclick="showSkimmerOptions(0)">S1: <span id="skimmer1">0</span>/20</div>&nbsp;
    <div class="skimmer" onclick="showSkimmerOptions(1)">S2: <span id="skimmer2">0</span>/20</div>&nbsp;
    <div class="skimmer" onclick="showSkimmerOptions(2)">S3: <span id="skimmer3">0</span>/20</div>
  </div>
</div>
</br>
<!-- Tlačítka ReRoll -->
<div id="rerolls">
  <button id="reRoll1" onclick="reRollDice(1)" class="reroll-button">ReRoll1</button>
  <button id="reRoll2" onclick="reRollDice(2)" class="reroll-button">ReRoll2</button>
  <button id="reRoll3" onclick="reRollDice(3)" class="reroll-button">ReRoll3</button>
</div>
</br>
<!-- Kostky -->
<div id="diceContainer">
  <div class="die" onclick="toggleDie(0)">1</div>
  <div class="die" onclick="toggleDie(1)">2</div>
  <div class="die" onclick="toggleDie(2)">3</div>
  <div class="die" onclick="toggleDie(3)">4</div>
  <div class="die" onclick="toggleDie(4)">5</div>
</div></br>
<div  id="score"class="score">Počet bodů: 0</div>
<div  id="high-score" class="highscore">Nejvyšší dosažené skóre: 0</div>

<!-- Tlačítko pro hod kostkami -->
<!-- <button id="rollButton" onclick="rollDice()">Hod kostkami</button> -->

<script>
function handleButtonClick() {
            // Logika pro zobrazení nápovědy
            const option = prompt(`Hra Trezor\nVyberte možnost: \n1) Zobrazit nápovědu\n2) Ukončit manuálně hru`, "Zvol 1 nebo 2");
  if (option === "1") {
    showHelp();
  } else if (option === "2") {
    calculateFinalScore();
    document.getElementById('score').innerText = `Počet bodů: ${score}`;
    confirm ("Hra skončila!");
  } else {
    confirm ("Neplatná volba. Zkuste to znovu.");
  }
}


// Otevření modálního okna
function showHelp() {
  document.getElementById('helpModal').style.display = 'block';
}

function closeHelp() {
  document.getElementById('helpModal').style.display = 'none';
}

// Zavření modálního okna, když uživatel klikne mimo něj
window.onclick = function(event) {
  if (event.target == document.getElementById('helpModal')) {
    document.getElementById('helpModal').style.display = 'none';
  }
}
  const boardLayout = [
    ['20', 'x', '6', '15', '4', '13', '12'],
    ['x', '7', '2', 'S', 'x', '5', 'x'],
    ['10', '11', 'L', 'x', 'D', '9', '6'],
    ['x', '14', 'x', '5', 'x', '3', '2'],
    ['9', '15', '4', 'D', '3', 'x', '4'],
    ['x', '12', 'x', '6', '5', '10', 'x']
  ];


let dice = [0, 0, 0, 0, 0]; // Hodnoty kostek
let skimmers = [0, 0, 0]; // Hodnoty pro skimmery
let selectedDice = []; // Uchování vybraných kostek
let currentRound = 1; // Aktuální kolo
let score = 0; // Body hráče
let unusedSkimmers = 0; // Pocet nepouzitychžitých Skimmerů
const totalRounds = 12; // Počet kol
const locks = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 3, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }]; // Název zámků
const lockPoints = { A: 1, B: 1, C: 1, D: 1, E: 1, F: 1, G: 2, H: 2, I: 2, J: 3, K: 3, L: 3 }; // Body za zámky

  // Vytvoření herní desky
  function createBoard() {
    const boardDiv = document.getElementById('board');
    for (let row = 0; row < boardLayout.length; row++) {
      for (let col = 0; col < boardLayout[row].length; col++) {
        const cellValue = boardLayout[row][col];
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.id = `cell-${row}-${col}`;
        cell.innerText = cellValue;

        if (cellValue === 'x') {
          cell.classList.add('disabled');
        } else {
          cell.onclick = () => markCell(row, col, cellValue); 
        }

        if (cellValue === 'L') cell.classList.add('odd');
        else if (cellValue === 'S') cell.classList.add('even');
        else if (cellValue === 'D') cell.classList.add('double');

        boardDiv.appendChild(cell);
      }
    }
  }

function loadHighScore() {
  const savedScore = localStorage.getItem('highScore');
  return savedScore ? parseInt(savedScore, 10) : 0;
}

function saveHighScore(score) {
  localStorage.setItem('highScore', score);
}

// Funkce pro získání skutečné barvy pozadí elementu
function getBackgroundColor(element) {
    return window.getComputedStyle(element, null).getPropertyValue('background-color');
}

// Funkce pro hod kostkami
function rollDice() {
  dice = Array.from({ length: 5 }, () => Math.floor(Math.random() * 6) + 1);
  const diceElements = document.querySelectorAll('.die');
  dice.forEach((value, index) => {
    diceElements[index].innerText = value;
    diceElements[index].classList.remove('clicked', 'used'); // Reset označení kostek při hodu
  });
  selectedDice = []; // Reset vybraných kostek při hodu
}

// Funkce pro zahájení nového kola
function startRound() {
      // Vyčištění předchozího zvýraznění
  locks.forEach(lock => {
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.remove('highlight-empty', 'highlight-filled');
      cell.style.color = ''; // Resetuje barvu textu
      cell.style.fontWeight = ''; // Resetuje tucnečné pismo textu
    });
  });
const currentLock = locks[currentRound - 1];
const lockName = currentLock.name;

// Zvýraznění aktuálního zámku
  currentLock.coordinates.forEach(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    const backgroundColor = getBackgroundColor(cell);
    if (backgroundColor === 'rgb(128, 128, 128)') {
            // Pokud je barva pozadí buňky šedá (rgb(128, 128, 128))
            
            cell.style.color = 'yellow'; // Nastavení žluté barvy textu pro buňky s šedým pozadím
            cell.style.fontWeight = 'bold'; // Nastavení tučného písma pro buňky s šedým pozadím
        } else {
            // Pokud je buňka nevyplněná
            cell.classList.add('highlight-empty');
        }
    
    
    //cell.classList.add('highlight');
  });
  if (currentRound > totalRounds) {
    confirm ("Hra skončila!");
    return;
  }
  confirm (`Zahajuje se kolo ${currentRound}: Řešíme zámek ${currentLock.name}`);
}



// Kontrola, zda byly všechny kostky použity
function checkAllDiceUsed() {
  const allUsed = Array.from(document.querySelectorAll('.die')).every(die => die.classList.contains('used'));
  if (allUsed) {
    endRound();
  }
}



// Funkce pro výpočet závěrečného skóre včetně nepoužitých skimmerů
function calculateFinalScore() {

  document.querySelectorAll('.skimmer').forEach((skimmer) => {
    if (!skimmer.classList.contains('disabled')) {
      unusedSkimmers++;
    }
  });

  // Přičtení bodů za nepoužité skimmery
  score += unusedSkimmers;

  confirm (`Konečné skóre: ${score} (zahrnuje počet bodů za nepoužité Skimmery : ${unusedSkimmers})`);

  const highScore = loadHighScore();
  if (score > highScore) {
    saveHighScore(score);
    confirm (`Gratulujeme! Dosáhli jste nového vysokého skóre: ${score}`);
  }
}



// Funkce pro ukončení kola
function endRound() {
  // Zkontrolujeme, zda jsou všechny relevantní buňky pro tento zámek vyplněny
  const lock = locks[currentRound - 1];
  const allCellsFilled = lock.coordinates.every(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    return cell.classList.contains('clicked');
  });

  if (allCellsFilled) {
      
   // Označíme všechny buňky tohoto zámku jako 'O' v herní desce
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.add('opened'); // Přidáme třídu 'opened' pro vizuální označení
      cell.textContent = 'o'; // Změníme obsah buňky na 'o'
    });   
      
    score += lockPoints[lock.name];
    confirm (`Zámek ${lock.name} zůstává otevřený, počet získaných diamantů: ${lockPoints[lock.name]}.`);
  } else {
    confirm (`Zámek ${lock.name} se uzamknul.`);
  }



  // Posun na další kolo a nový hod kostkami
  currentRound++;
  if (currentRound <= locks.length) {
  	document.getElementById('score').innerText = `Počet bodů: ${score}`;
    rollDice();
    startRound();
   
  } else {
   
    calculateFinalScore();
   	document.getElementById('score').innerText = `Počet bodů: ${score}`;
    confirm ("Hra skončila!");
  }
}



// Aktualizace tlačítek ReRoll
  function updateReRollButtons() {
    const isAnyDieSelected = selectedDice.some(selected => selected);
    const reRollButtons = document.querySelectorAll('.reroll-button');
    reRollButtons.forEach(button => {
      button.classList.toggle('disabled', !isAnyDieSelected);
    });
  }

  // Možnost opakovaného hodu
function reRollDice(rerollIndex) {
  if (selectedDice.length > 0) {    
  const diceElements = document.querySelectorAll('.die:not(.used).clicked');
  diceElements.forEach((die, index) => {
    const newRoll = Math.floor(Math.random() * 6) + 1; // Nová hodnota od 1 do 6
    die.innerText = newRoll;
    die.classList.remove('clicked'); // Reset kliknutí po hodu

    // Aktualizace pole dice pro tuto kostku
    const dieIndex = Array.from(document.querySelectorAll('.die')).indexOf(die);
    dice[dieIndex] = newRoll;
  });

  // Reset pole selectedDice, aby obsahovalo pouze nové hodnoty
  selectedDice = []; // Tím zajistíme, že se staré hodnoty nepřičítají
  const button = document.getElementById(`reRoll${rerollIndex}`);
  button.classList.add('disabled');
  button.onclick = null; // Zamezení opětovnému kliknutí
  } else {
    confirm ("Vyberte alespoň jednu kostku pro opakovaný hod.");
  }
}

function showSkimmerOptions(index) {
  const skimmerName = `Skimmer ${index + 1}`;
  const option = prompt(`Vybrali jste ${skimmerName}\nVyberte možnost: \n1) Uložit do něj hodnoty kostek \n2) Použít ho jako další kostku`, "Zvol 1 nebo 2");
  if (option === "1") {
    addDiceToSkimmer(index);
  } else if (option === "2") {
    useSkimmerAsDie(index);
  } else {
    confirm ("Neplatná volba. Zkuste to znovu.");
  }
}

// Přidání vybraných kostek do skimmeru
function addDiceToSkimmer(index) {
  if (document.querySelectorAll('.skimmer')[index].classList.contains('disabled')) {
    confirm ("Tento Skimmer již nelze použít.");
    return;
  }  
  if (selectedDice.length > 0) {
    // Součet hodnot vybraných kostek
    const diceSum = selectedDice.reduce((a, b) => a + b, 0);
    const remainingCapacity = 20 - skimmers[index];

    // Kontrola, zda vybrané kostky nepřesahují zbývající kapacitu skimmeru
    if (diceSum > remainingCapacity) {
      confirm (`Nelze přidat: hodnota kostek ${diceSum} překračuje zbývající kapacitu skimmeru ${remainingCapacity}.`);
    } else {
      // Přidání kostek do skimmeru a aktualizace UI
      skimmers[index] += diceSum;
      document.getElementById(`skimmer${index + 1}`).innerText = skimmers[index];

      // Označení vybraných kostek jako použitých
      document.querySelectorAll('.die.clicked').forEach(die => {
        die.classList.add('used');
        die.classList.remove('clicked');
      });

      selectedDice = []; // Reset vybraných kostek po přenosu

      // Zkontrolovat, zda byly použity všechny kostky
      checkAllDiceUsed();
    }
  } else {
    confirm ("Vyberte alespoň jednu kostku pro přesun do skimmeru.");
  }
}

function useSkimmerAsDie(index) {
  if (skimmers[index] > 0) {
    selectedDice.push(skimmers[index]);
    document.querySelectorAll('.skimmer')[index].classList.add('disabled');
    document.querySelectorAll('.skimmer')[index].onclick = null; // Zamezení opětovnému použití skimmeru
    confirm (`Vybrali jste Skimmer ${index + 1}\nByl použit jako kostka\ns hodnotou ${skimmers[index]}.\nVyber pole na hrací desce,\npřípadně zkombinuj s jinou kostkou.`);
  } else {
    confirm ("Hodnota Skimmeru musí být minimálně 1.");
  }
}

function toggleDie(index) {
  const die = document.querySelectorAll('.die')[index];
  if (!die.classList.contains('used')) { // Pouze pokud kostka nebyla použita
    die.classList.toggle('clicked');
    if (die.classList.contains('clicked')) {
      selectedDice.push(index); // Přidáme index kostky
    } else {
      selectedDice = selectedDice.filter(i => i !== index); // Odebrání indexu kostky
    }
  }
}

  // Přepnutí stavu kostky (označení/odznačení) a přidání/odebrání její hodnoty do/z vybraných kostek
  function toggleDie(index) {
    const die = document.querySelectorAll('.die')[index];
    const dieValue = dice[index];

    if (!die.classList.contains('used')) { // Kostku lze vybrat, pouze pokud nebyla použita
      die.classList.toggle('clicked');

      if (die.classList.contains('clicked')) {
        selectedDice.push(dieValue); // Přidat hodnotu kostky do vybraných
      } else {
        selectedDice = selectedDice.filter(value => value !== dieValue); // Odebrat hodnotu kostky
      }
    }
  }

// Funkce pro označení políčka na desce podle pravidel pro 'L', 'S' a 'D'
function markCell(row, col, cellValue) {
  const cell = document.getElementById(`cell-${row}-${col}`);
  
  // Podmínky pro jednotlivé kombinace kostek
  const isSingleOdd = selectedDice.length === 1 && selectedDice[0] % 2 !== 0;
  const isSingleEven = selectedDice.length === 1 && selectedDice[0] % 2 === 0;
  const isDoubleSame = selectedDice.length === 2 && selectedDice[0] === selectedDice[1];

  // Funkce pro generování všech možných součtů a rozdílů z vybraných kostek
  function generatePossibleSumsAndDiffs(diceArray) {
    const results = new Set();
    
    // Rekurzivní funkce pro generování všech kombinací sčítání a odečítání
    function calculateCombinations(dice, currentSum, currentDiff) {
      if (dice.length === 0) {
        results.add(currentSum); // Přidáme součet
        results.add(Math.abs(currentDiff)); // Přidáme rozdíl
        return;
      }

      // Pro každou kostku, rozhodneme, zda ji přičteme nebo odečteme
      for (let i = 0; i < dice.length; i++) {
        const remainingDice = dice.slice(0, i).concat(dice.slice(i + 1));

        // Představuje možnost přičíst aktuální kostku
        calculateCombinations(remainingDice, currentSum + dice[i], currentDiff + dice[i]);
        
        // Představuje možnost odečíst aktuální kostku
        calculateCombinations(remainingDice, currentSum - dice[i], currentDiff - dice[i]);
      }
    }

    // Začneme rekurzivní výpočty pro všechny kostky
    calculateCombinations(diceArray, 0, 0);

    return results;
  }

  // Vygeneruj všechny možné součty a rozdíly
  const possibleSumsAndDiffs = generatePossibleSumsAndDiffs(selectedDice);

  // Zkontroluj, jestli hodnota buňky odpovídá některému z možných součtů nebo rozdílů
  if (
    (cellValue === 'L' && isSingleOdd) ||
    (cellValue === 'S' && isSingleEven) ||
    (cellValue === 'D' && isDoubleSame) ||
    possibleSumsAndDiffs.has(parseInt(cellValue)) // Zkontroluj, jestli je hodnota v seznamu možných součtů a rozdílů
  ) {
    cell.classList.add('clicked'); // Označení políčka jako "kliknuté"

    // Označení vybraných kostek jako použitých a odstranění jejich výběru
    document.querySelectorAll('.die.clicked').forEach(die => {
      die.classList.add('used');
      die.classList.remove('clicked');
    });

    selectedDice = []; // Reset vybraných kostek po použití

    // Zkontrolovat, zda byly použity všechny kostky
    checkAllDiceUsed();
  } else {
    confirm ("Hodnota kostek neodpovídá požadavkům na toto pole.");
  }
}

function startGame() {
  currentRound = 1;
  score = 0;
  rollDice();
  startRound();
  document.getElementById('score').innerText = `Počet bodů: ${score}`;
  
  const highScore = loadHighScore();
  document.getElementById('high-score').innerText = `Nejvyšší dosažené skóre: ${highScore}`;
}




// Inicializace hry
function initGame() {
  createBoard();
  startGame();
}


initGame();


</script>